"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EMV=t()}(void 0,function(){function e(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e){var t=["string","number","boolean","undefined","symbol"];return-1!==t.indexOf("undefined"==typeof e?"undefined":_typeof(e))||null===e}function r(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var i=null,n=null,o=!1,a=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","if","in","instanceof","new","return","switch","throw","try","typeof","var","void","while","with","class","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield"],c=new RegExp("\\b("+a.join("|")+")\\b","g"),s=function(e){function t(e){_classCallCheck(this,t);var r="EMV Error : "+e;return _possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r))}return _inherits(t,e),t}(Error),u=function(e){function r(e,a,c,s){var u;_classCallCheck(this,r);var l=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));l.$callers={},l.$directives={},l.$watchers={},l.$root=a||l,l.$parent=c,l.$computed={},l.$this=l;var d={get:function(e,t){if("string"!=typeof t)return e[t];var r=e[t];return"$"===t.substr(0,1)?this[t]:(this.$root&&"function"!=typeof r&&(i&&(this.$callers[t]||(this.$callers[t]={}),this.$callers[t][i.uid]||Object.keys(this.$root.$computed).every(function(e){return this.$root.$computed[e]===i?(this.$callers[t][i.uid]={property:e,reader:i.reader,writer:i.writer,object:i.object},!1):!0}.bind(this))),n&&(this.$directives[t]||(this.$directives[t]={}),this.$directives[t][n.uid]||(this.$directives[t][n.uid]=n))),r)}.bind(l),set:function(e,i,n){if("string"!=typeof i)return!0;var a=!1,c="$"===i.substr(0,1);if(i in e||o||(a=!0),c||"function"==typeof n)return e[i]=n,!0;var u=e[i];if(t(n)||n instanceof r?(e[i]=n,n instanceof f&&(n.$root=this.$root||e,n.$parent=e)):e[i]=new r(n,this.$root||e,e,i),this.$computed[i]&&this.$computed[i].writer)try{this.$computed[i].writer(e,n,u)}catch(l){}return(u!==n||Array.isArray(e)&&"length"===i)&&(this.$notifySubscribers(i,n,u),a&&this.$parent&&this.$parent.$notifySubscribers(s,this.$parent)),!0}.bind(l),deleteProperty:function(e,t){if("string"!=typeof t)return!0;var r="$"===t.substr(0,1),i=e[t];return delete e[t],r||(this.$notifySubscribers(t,void 0,i),this.$parent.$notifySubscribers(s,this.$parent)),!0}.bind(l),ownKeys:function(e){return Object.getOwnPropertyNames(e).filter(function(e){return"$"!==e.substr(0,1)})}},$=new Proxy(l,d);return Object.keys(e).forEach(function(t){$[t]=e[t]}),u=$,_possibleConstructorReturn(l,u)}return _inherits(r,e),_createClass(r,[{key:"$notifySubscribers",value:function(e,t,r){var i=this;return e?(void 0===t&&(t=this[e]),this.$callers[e]&&Object.keys(this.$callers[e]).forEach(function(t){var r=this.$callers[e][t];r.object[r.property]=r.reader(r.object)}.bind(this)),this.$watchers[e]&&Object.keys(this.$watchers[e]).forEach(function(i){this.$watchers[e][i].call(this,t,r)}.bind(this)),void(this.$directives[e]&&Object.keys(this.$directives[e]).forEach(function(t){var r=this.$directives[e][t];r.handler.update&&r.handler.update(r.element,r.parameters,r.model,r.context)}.bind(this)))):void Object.keys(this).forEach(function(e){i.$notifySubscribers(e)})}},{key:"$isArray",value:function(){for(var e in this)if(isNaN(e)&&e!==length)return!1;return!0}},{key:"$cleanDirectives",value:function(e){var t=this;e.$directives&&Object.keys(e.$directives).forEach(function(r){Object.keys(t.$directives).forEach(function(i){var n=e.$uid+r;delete t.$directives[i][n]})}),Object.keys(this).forEach(function(i){t[i]instanceof r&&t[i].$cleanDirectives(e)})}},{key:"valueOf",value:function(){var e=this,t=this.$isArray()?[]:{};return Object.keys(this).forEach(function(r){t[r]=e[r]?e[r].valueOf():e[r]}),t}},{key:"toString",value:function(){return JSON.stringify(this.valueOf())}}]),r}(Array),l=function v(t,r){_classCallCheck(this,v);var n=this;this.uid=e(),this.object=r,"function"==typeof t&&(t={read:t}),t.write&&(this.writer=function(e,r,i){t.write.call(e,r,i)}),t.read&&(this.reader=function(e){var r=i;i=n;var o=void 0;try{o=t.read.call(e)}catch(a){o=void 0}return i=r,o})},d=function h(t,r){_classCallCheck(this,h),this.name=t;var i=this,o=function(o){r[o]&&(this[o]=function(a,c,s,u){a.$uid||(a.$uid=e()),n={element:a,parameters:c,model:s,context:u,handler:i,uid:a.$uid+t,name:t},r[o](a,c,s,u),n=null})}.bind(this);o("init"),o("bind"),o("update")},f=function(t){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e.data));return t.$templates={},e.computed&&Object.keys(e.computed).forEach(function(t){this.$computed[t]=new l(e.computed[t],this)}.bind(t)),Object.keys(t.$computed).forEach(function(e){t.$computed[e].reader?t[e]=t.$computed[e].reader(t):t[e]=void 0}),t}return _inherits(i,t),_createClass(i,[{key:"$watch",value:function(t,r){var i=this;if(Array.isArray(t))return void t.forEach(function(e){i.$watch(e,r)});var n=t.split("."),o=void 0,a=n.pop();o=this.$this,n.forEach(function(e){o=o[e]}),o&&(o.$watchers[a]||(o.$watchers[a]={}),r.uid=e(),o.$watchers[a][r.uid]=r)}},{key:"$unwatch",value:function(e,t){var r=e.split("."),i=void 0;i=this.$this,r.forEach(function(e){i=i[e]}),t?delete i.$watchers[t]:i.$watchers={}}},{key:"$apply",value:function(e){if(this.$rootElement)throw new s("an emv instance cannot be instanciated on multiple DOM elements.");this.$rootElement=e||document.body,this.$createContext(this.$rootElement,this),this.$parse(this.$rootElement),this.$render(this.$rootElement)}},{key:"$clean",value:function(e){var t=this,r=e||this.$rootElement;r&&(this.$cleanDirectives(r),delete r.$directives,r.children&&Array.from(r.children).forEach(function(e){t.$clean(e)}),delete this.$rootElement)}},{key:"$parse",value:function(e,t){var n=this,o=new RegExp(r(i.config.delimiters[0])+"(.+?)"+r(i.config.delimiters[1]),"g"),a=new RegExp(r(i.config.htmlDelimiters[0])+"(.+?)"+r(i.config.htmlDelimiters[1]),"g");if("template"===e.nodeName.toLowerCase())this.$templates[e.id]=e.innerHTML;else if("#text"===e.nodeName.toLowerCase()){var c=e.textContent,s=c.match(o),u=c.match(a);if(s||u){this.$getContext(e.parentNode),e.parentNode.$directives||(e.parentNode.$directives={});var l=c.replace(o,"' + ($1) + '").replace(a,"' + ($1) + '").replace(/^\s+/,"").replace(/\s+$/,"");u?e.parentNode.$directives.html={name:"html",handler:i.directives.html,parameters:"'"+l+"'"}:e.parentNode.$directives.text={name:"text",handler:i.directives.text,parameters:"'"+l+"'"}}}else e.attributes&&(Object.keys(i.directives).forEach(function(r){if(!t||-1===t.indexOf(r)){var o=i.config.attributePrefix+"-"+r,a=e.getAttribute(o);if(a){var c=i.directives[r];e.$directives||(e.$directives={}),n.$getContext(e),e.$directives[r]={name:r,handler:c,parameters:a},c.init&&c.init.call(n,e,a,n)}}}),Array.from(e.attributes).forEach(function(t){var r=t.name,n=t.textContent,a=n.match(o);if(null!==a){e.$directives||(e.$directives={});var c=e.$directives.attr,s=c&&c.parameters||"";s&&(s=s.substring(1,s.length-1)+","),s+=r+" : '"+n.replace(o,"' + ($1) + '")+"'",s="{"+s+"}",c?c.parameters=s:e.$directives.attr={name:"attr",handler:i.directives.attr,parameters:s}}}));e.childNodes&&Array.from(e.childNodes).forEach(function(e){n.$parse(e)})}},{key:"$render",value:function(e,t){var r=this;e.$directives&&Object.keys(e.$directives).forEach(function(r){if(!t||-1===t.indexOf(r)){var i=e.$directives[r],n=i.handler,o=i.parameters;n.bind&&n.bind.call(this,e,o,this),n.update&&n.update.call(this,e,o,this)}}.bind(this)),e.childNodes&&Array.from(e.childNodes).forEach(function(e){r.$render(e)})}},{key:"$createContext",value:function(e,t,r){o=!0;var i=t;t instanceof u?(i.$this=t,i.$parent=t.$parent,i.$root=this):i={$this:t,$parent:t.$parent,$root:this};var n=this.$getAdditionalContextProperties(e);n.forEach(function(t){if(-1!==["$this","$parent","$root"].indexOf(t))throw new s("You cannot apply the key '"+t+"' as additionnal context property");i[t]=e.parentNode.$context[t]}),e.$additionalContextProperties=new Set(Array.from(n)),r&&Object.keys(r).forEach(function(t){i[t]=r[t],e.$additionalContextProperties.add(t)}),e.$context=i,o=!1}},{key:"$removeContext",value:function(e){var t=this;delete e.$context,e.children&&Array.from(e.children).forEach(function(e){t.$removeContext(e)})}},{key:"$getContext",value:function(e){if(e.$context)return e.$context;var t=this.$getContext(e.parentNode);return e.$context=t,t}},{key:"$getAdditionalContextProperties",value:function(e){if(e.$additionalContextProperties)return e.$additionalContextProperties;if(e===this.$rootElement)return new Set([]);var t=this.$getAdditionalContextProperties(e.parentNode);return e.$additionalContextProperties=t,t}},{key:"$parseDirectiveGetterParameters",value:function(e){return new Function("$context","\n                var result;\n                with($context) {\n                    result=("+e+");\n                    // result=("+e.replace(c,"$this.$1")+");\n                };\n                return result;\n            ")}},{key:"$getDirectiveValue",value:function(e,t,r){var i=this.$parseDirectiveGetterParameters(e);try{return i(r||this.$getContext(t))}catch(n){return}}},{key:"$parseDirectiveSetterParameters",value:function(e){return new Function("$context","$value","\n                with($context) {\n                    "+e.replace(c,"$this.$1")+" = $value;\n                }\n            ")}},{key:"$setDirectiveValue",value:function(e,t,r){var i=this.$parseDirectiveSetterParameters(e);i(this.$getContext(t),r)}},{key:"$insertRemoveElement",value:function(e,t,r){if(r||(r=e),t&&!r.$parent.contains(e)){var i=null;r.$before.every(function(e){return r.$parent.contains(e)?(i=e,!1):!0}),i?i.nextElementSibling?r.$parent.insertBefore(e,i.nextElementSibling):r.$parent.appendChild(e):r.$parent.insertBefore(e,e.$parent.firstChild);var o=null;n&&(o=[n.name]),this.$render(e,o)}else e.$parent.contains(e)&&!t&&e.$parent.removeChild(e)}}],[{key:"directive",value:function(e,t){this.directives[e]=new d(e,t)}}]),i}(u);f.directives={},f.directive("show",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e);i?e.style.display="":e.style.display="none"}}),f.directive("class",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e);e.originalClassList||(e.originalClassList=[],e.classList.forEach(function(t){e.originalClassList.push(t)})),e.classList.forEach(function(t){-1===e.originalClassList.indexOf(t)&&e.classList.remove(t)}),i&&("string"==typeof i&&(i=_defineProperty({},i,!0)),"object"===("undefined"==typeof i?"undefined":_typeof(i))&&Object.keys(i).forEach(function(t){var r=t.split(" "),n=e.classList;r.forEach(function(e){i[t]?n.add(e):n.remove(e)})}))}}),f.directive("style",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e);i&&"object"===("undefined"==typeof i?"undefined":_typeof(i))&&Object.keys(i).forEach(function(t){var r=i[t];r?e.style[t]=r:delete e.style[t]})}}),f.directive("attr",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e);i&&"object"===("undefined"==typeof i?"undefined":_typeof(i))&&Object.keys(i).forEach(function(t){var r=i[t];r?e.setAttribute(t,r):e.removeAttribute(t)})}}),f.directive("disabled",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e);i?e.setAttribute("disabled",!0):e.removeAttribute("disabled")}}),f.directive("value",{bind:function(e,t,r){e.onchange=function(){var i=void 0,n=e.nodeName.toLowerCase(),o=e.type;switch(n){case"input":case"select":switch(o){case"checkbox":i=Boolean(e.checked);break;case"radio":i=document.querySelector('input[name="'+e.name+'"]:checked').value;break;default:i=e.value}break;case"textarea":i=e.value;break;default:return}r.$setDirectiveValue(t,e,i)}},update:function(e,t,r){var i=r.$getDirectiveValue(t,e);void 0===i&&(i="");var n=e.nodeName.toLowerCase(),o=e.type;switch(n){case"input":case"select":switch(o){case"checkbox":e.checked=Boolean(i);break;case"radio":var a=document.querySelector('input[name="'+e.name+'"][value="'+i+'"]');a&&(a.checked=!0);break;default:e.value=i}break;case"textarea":e.value=i;break;default:e.value=i}}}),f.directive("input",{bind:function(e,t,r){e.addEventListener("input",function(){r.$setDirectiveValue(t,e,e.value)})},update:function(e,t,r){var i=r.$getDirectiveValue(t,e);e.value=i}}),f.directive("focus",{bind:function(e,t,r){e.addEventListener("focus",function(){r.$setDirectiveValue(t,e,!0)}),e.addEventListener("blur",function(){r.$setDirectiveValue(t,e,!1)})},update:function(e,t,r){var i=r.$getDirectiveValue(t,e);i?e.focus():e.blur()}}),f.directive("options",{update:function(e,t,r){if("select"!==e.nodeName.toLowerCase())throw new s("options directive can be applied only on select tags");var i=r.$getDirectiveValue(t,e),n=i;if(i&&(!("$data"in i)||i.$data)){i.$data&&(n={},Object.keys(i.$data).forEach(function(e){if(!Array.isArray(i.$data)||"length"!==e){var t=i.$data[e],r=i.$value?t[i.$value]:e,o=i.$label?t[i.$label]:t;n[r]=o}}));var o=e.value||i.$selected;e.innerHTML="";var a=function(t,r){var i=document.createElement("option");i.value=t,i.innerText=r,t.toString()===o&&(i.selected=!0),e.appendChild(i)};Array.isArray(n)?n.forEach(function(e,t){a(t,e)}):Object.keys(n).forEach(function(e){var t=n[e];a(e,t)}),e.onchange&&e.onchange()}}}),f.directive("text",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e);e.innerText=i}}),f.directive("html",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e);e.innerHTML=i}}),f.directive("click",{bind:function(e,t,r){var i=r.$parseDirectiveGetterParameters(t);e.onclick=function(t){var n=r.$getContext(e),o=i(n,t);"function"==typeof o&&o.call(n.$this,n,t)}}}),f.directive("on",{bind:function(e,t,r){var i=r.$parseDirectiveGetterParameters(t),n=i(r.$getContext(e));"object"===("undefined"==typeof n?"undefined":_typeof(n))&&Object.keys(n).forEach(function(t){var i=n[t],o="on"+t;e[o]=function(t){i(r.$getContext(e),t)}})}}),f.directive("submit",{bind:function(e,t,r){if("form"!==e.nodeName.toLowerCase())throw new s("submit directive can be applied only on form tags");var i=r.$parseDirectiveGetterParameters(t);e.addEventListener("submit",function(t){var n=i(r.$getContext(e));"function"==typeof n&&n(r.$getContext(e),t)})}});var $=function(e){e.$before=[],e.previousElementSibling&&(e.$before=[e.previousElementSibling],e.previousElementSibling.$before&&(e.$before=e.$before.concat(e.previousElementSibling.$before))),e.$parent=e.parentNode};return f.directive("each",{options:{comments:!0},init:function(t,r){$(t);var i=t.parentNode,n=e();t.$clones=[];var o=document.createElement(t.nodeName);o.$eachElement=t,o.$directives={each:t.$directives.each},delete t.$directives.each,o.setAttribute(f.config.attributePrefix+"-each",r),o.id=n,i.replaceChild(o,t)},update:function(e,t,r){var i=e.$eachElement,n=r.$getDirectiveValue(t,i);i.$clones.forEach(function(e){e.parentNode&&e.parentNode.contains(e)&&e.parentNode.removeChild(e)}),e.parentNode&&e.parentNode.contains(e)&&e.parentNode.removeChild(e),i.$clones=[],n&&!function(){var e=n&&Array.from("$data"in n?n.$data:n)||[];e=e.filter(function(e){return e}),n.$filter&&(e=e.filter(n.$filter)),n.$sort&&("function"==typeof n.$order?e.sort(n.$sort):e.sort(function(e,t){return e[n.$sort]<t[n.$sort]?-1:1})),n.$order&&n.$order<0&&e.reverse();var t=n.$offset||0,o=t+(n.$limit||e.length);e=e.slice(t,o),e.reverse(),e.forEach(function(t,o){var a=e.length-1-o,c={$index:a};n.$item&&(c["$"+n.$item]=t);var s=i.cloneNode(!0);s.$parent=i.$parent,s.$directives=i.$directives,delete s.$directives.each,r.$insertRemoveElement(s,!0,i),r.$createContext(s,t,c),i.$clones.push(s),r.$parse(s,["each"]),r.$render(s,["each"])})}()}}),f.directive("if",{init:function(e){$(e)},update:function(e,t,r){var i=r.$getDirectiveValue(t,e);r.$insertRemoveElement(e,Boolean(i))}}),f.directive("unless",{init:function(e){$(e)},update:function(e,t,r){var i=r.$getDirectiveValue(t,e);r.$insertRemoveElement(e,!i)}}),f.directive("with",{init:function(e,t,r){var i=r.$getDirectiveValue(t,e===r.$rootElement?e:e.parentNode);r.$createContext(e,i)},update:function(e,t,r){var i=void 0;e===r.$rootElement?i=r.$getDirectiveValue(t,e,r):(r.$removeContext(e),i=r.$getDirectiveValue(t,e.parentNode)),r.$createContext(e,i),r.$render(e,["with"])}}),f.directive("template",{update:function(e,t,r){var i=r.$getDirectiveValue(t,e),n=r.$templates[i];e.innerHTML=n,e.children&&Array.from(e.children).forEach(function(t){r.$createContext(t,r.$getContext(e)),r.$parse(t),r.$render(t)})}}),f.config={attributePrefix:"e",templateEngine:"",delimiters:["${","}"],htmlDelimiters:["!{","}"]},Object.defineProperty(f,"version",{value:"1.0.0",writable:!1}),f});